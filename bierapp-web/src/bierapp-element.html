<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer-fontawesome/polymer-fontawesome.html">
<link rel="import" href="../bower_components/sortable-table/sortable-table.html">
<link rel="import" href="../bower_components/core-list/core-list.html">


<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-header.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-footer.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-project-browser.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-biotype.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-job-no-ready.html">

<link rel="import" href="bierapp-home.html">

<polymer-element name="bierapp-element">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                cursor: default;
                font-size: 13px;
            }

            .content {
                background-color: #435f7a;
                position: relative;
                /*min-height: calc(100vh - 160px);*/
            }

            .content > * {
                min-height: calc(100vh - 160px);
            }

            jso-project-browser {
                height: calc(100vh - 160px);
            }
        </style>
        <jso-header id="jsoHeader"
                    on-session-change="{{handleSessionChange}}"
                    selectedOption="{{selectedOption}}"
                    userData="{{userData}}"
                    showJobs="{{showJobs}}"
                    options="{{options}}"
                    studies="{{studies}}"
                    selectedStudy="{{selectedStudy}}"
                    allowedTools="{{allowedTools}}"
                    jobItem="{{jobItem}}"
                    helpLink="https://github.com/babelomics/babelomics/wiki"
                    tutorialLink="https://github.com/babelomics/babelomics/wiki/Tutorial"
                    hideHomeLink="true">
            <span class="title">BierApp</span>
            <img class="description" src="http://bioinfo.cipf.es/bierwiki/lib/tpl/arctic/images/logobier.jpg"
                 height="35px"/>
        </jso-header>
        <div class="content">
            <template if="{{ selectedOption == 'home' || selectedOption == 'none' || selectedOption == ''}}">
                <bierapp-home></bierapp-home>
            </template>
            <jso-job-no-ready hidden?="{{selectedOption != 'jobNoReady' }}" jobItem="{{jobItem}}"></jso-job-no-ready>
            <template if="{{selectedOption == 'projects'}}">
                <jso-project-browser userData="{{userData}}" selectedStudy="{{selectedStudy}}" studies="{{studies}}"
                                     selectedProject="{{selectedProject}}"></jso-project-browser>
            </template>
        </div>
        <jso-footer>
            BierApp: created by Computational Genomics Department
            <br>
            Principe Felipe Research Center
            <br>
            2015
        </jso-footer>

    </template>
    <script>
        Polymer({
            created: function () {
                this.selectedOption = 'home';
                this.showJobs = true;
                this.userData = {};

                this.selectedProject;
                this.selectedStudy;
                this.studies;
            },
            userDataChanged: function (oldValue, newValue) {
                var me = this;
                this.selectedProject = this.userData.projects[0];

                OpencgaManager.projects.studies({
                    id: this.selectedProject.id,
                    query: {
                        sid: Cookies("bioinfo_sid")
                    },
                    request: {
                        success: function (response) {
                            if (response.response[0].errorMsg === '' || response.response[0].errorMsg == null) {
                                me.studies = response.response[0].result;
                                me.selectedStudy = me.studies[0];
                            } else {
                                console.log(response.error);
                                console.log(response.response[0].errorMsg);
                            }
                        },
                        error: function () {
                            console.log('Server error, try again later.');
                        }
                    }
                })
            }
        });
    </script>
</polymer-element>
